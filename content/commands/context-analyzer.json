{
  "description": "Analyze codebase context with agentic search to understand architecture, patterns, and dependencies before major refactors or feature implementations",
  "category": "commands",
  "author": "JSONbored",
  "dateAdded": "2025-10-25",
  "tags": [
    "context-analysis",
    "codebase-understanding",
    "architecture",
    "agentic-search",
    "refactoring",
    "planning"
  ],
  "content": "The `/context-analyzer` command performs deep codebase analysis using Claude's agentic search to understand architecture, patterns, and dependencies for informed decision-making.\n\n## Features\n\n- **Agentic Search**: Scan and interpret entire project automatically\n- **Architecture Mapping**: Visualize system structure and relationships\n- **Pattern Detection**: Identify common patterns and conventions\n- **Dependency Analysis**: Understand module dependencies and coupling\n- **Tech Stack Discovery**: Auto-detect frameworks, libraries, versions\n- **Code Quality Metrics**: Assess maintainability and technical debt\n- **Refactoring Prerequisites**: Gather context before major changes\n- **Onboarding Tool**: Help new developers understand codebase\n\n## Usage\n\n```bash\n/context-analyzer [scope] [options]\n```\n\n### Scope\n\n- `--full` - Analyze entire codebase (default)\n- `--directory=<path>` - Analyze specific directory\n- `--module=<name>` - Analyze specific module/feature\n- `--file=<path>` - Deep analysis of single file\n\n### Analysis Types\n\n- `--architecture` - System architecture and structure\n- `--patterns` - Code patterns and conventions\n- `--dependencies` - Dependency graph and coupling\n- `--tech-stack` - Technology stack inventory\n- `--quality` - Code quality and technical debt\n- `--all` - Comprehensive analysis (all types)\n\n### Output\n\n- `--summary` - Executive summary only\n- `--detailed` - Full analysis report\n- `--save-to=<file>` - Save report to file\n\n## Examples\n\n### Full Codebase Analysis\n\n**Command:**\n```bash\n/context-analyzer --full --all\n```\n\n**Analysis Report:**\n```\n[Context Analysis: Full Codebase]\n[Using Agentic Search to scan project...]\n\n====================\nPROJECT OVERVIEW\n====================\n\nName: E-Commerce SaaS Platform\nSize: 450 files, 85K LOC\nLanguages: TypeScript (95%), CSS (3%), JSON (2%)\nLast Modified: 2 hours ago\n\n====================\nTECH STACK\n====================\n\nFrontend:\n  - React 19.1.1 (Server Components)\n  - Next.js 15.5.2 (App Router)\n  - TailwindCSS v4.1.13\n  - shadcn/ui components\n  - Framer Motion 11.x\n\nBackend:\n  - Next.js API Routes\n  - tRPC 11.x (type-safe APIs)\n  - Prisma 5.x (ORM)\n  - PostgreSQL 16\n\nAuthentication:\n  - better-auth v1.3.9\n  - JWT + Refresh tokens\n  - OAuth2 (Google, GitHub)\n\nTesting:\n  - Vitest (unit/integration)\n  - Playwright (E2E)\n  - React Testing Library\n\nTooling:\n  - TypeScript 5.3 (strict mode)\n  - Biome (linting/formatting)\n  - pnpm (package manager)\n\n====================\nARCHITECTURE\n====================\n\nPattern: Layered Architecture\n\n1. Presentation Layer (app/)\n   - Route groups: (auth), (dashboard), (marketing)\n   - Server Components for data fetching\n   - Client Components for interactivity\n   - Layouts with nested routing\n\n2. API Layer (app/api/)\n   - tRPC routers (type-safe)\n   - REST endpoints (webhooks, public API)\n   - Middleware (auth, rate limiting)\n\n3. Business Logic (lib/)\n   - Services: auth, payments, notifications\n   - Utilities: validation, formatting\n   - Types: shared interfaces\n\n4. Data Layer (prisma/)\n   - Schema: 15 models\n   - Migrations: 23 migrations\n   - Seeders: test data\n\nKey Directories:\n  app/           - Next.js routes (78 files)\n  components/    - React components (125 files)\n  lib/          - Business logic (45 files)\n  hooks/        - Custom React hooks (18 files)\n  prisma/       - Database schema (3 files)\n  tests/        - Test files (89 files)\n\n====================\nCODE PATTERNS\n====================\n\nDetected Patterns:\n\n1. Server Component Data Fetching:\n   ```typescript\n   // Pattern found in 42 files\n   export async function Component() {\n     const data = await db.query();\n     return <div>{data}</div>;\n   }\n   ```\n\n2. Form Handling (react-hook-form + Zod):\n   ```typescript\n   // Pattern found in 15 files\n   const form = useForm({\n     resolver: zodResolver(schema)\n   });\n   ```\n\n3. tRPC API Calls:\n   ```typescript\n   // Pattern found in 38 files\n   const { data, isLoading } = trpc.users.list.useQuery();\n   ```\n\n4. Error Boundaries:\n   ```typescript\n   // Pattern found in 8 layouts\n   <ErrorBoundary fallback={<ErrorPage />}>\n     {children}\n   </ErrorBoundary>\n   ```\n\n5. Authentication Guards:\n   ```typescript\n   // Pattern found in 12 routes\n   const session = await auth();\n   if (!session) redirect('/login');\n   ```\n\n====================\nDEPENDENCY ANALYSIS\n====================\n\nHigh Coupling (Needs Refactoring):\n  - auth.service.ts â†’ 23 files depend on it\n  - db/client.ts â†’ 45 files import directly\n  - utils/validation.ts â†’ 18 files\n\nLow Coupling (Good):\n  - components/ui/* â†’ Self-contained\n  - hooks/* â†’ Independent\n\nCircular Dependencies: None detected âœ“\n\nExternal Dependencies:\n  - Production: 45 packages\n  - Development: 28 packages\n  - Total bundle size: 287 KB (gzipped)\n\nHeaviest Dependencies:\n  1. next: 105 KB\n  2. react-dom: 42 KB  \n  3. framer-motion: 38 KB\n  4. @trpc/client: 28 KB\n\n====================\nCODE QUALITY\n====================\n\nMetrics:\n  - Test Coverage: 78% (target: 80%)\n  - TypeScript Errors: 0\n  - Linting Warnings: 3\n  - Duplicate Code: 2.1%\n  - Complexity (avg): 4.2 (good)\n\nTechnical Debt:\n  ðŸŸ¡ Medium Debt (Manageable)\n  \n  Priority Issues:\n  1. auth.service.ts high coupling (23 dependencies)\n  2. 3 components exceed 250 lines\n  3. 5 files missing JSDoc comments\n  4. 2% test coverage gap\n\nStrengths:\n  âœ“ Consistent naming conventions\n  âœ“ Strong TypeScript usage (strict mode)\n  âœ“ Good file organization\n  âœ“ Modern React patterns\n  âœ“ Proper error handling\n\n====================\nRECOMMENDATIONS\n====================\n\n1. Refactor auth.service.ts\n   - Extract to smaller services\n   - Reduce coupling (23 â†’ <10 dependencies)\n\n2. Increase test coverage\n   - Add tests for: payments/, notifications/\n   - Target: 78% â†’ 80%\n\n3. Component splitting\n   - Break down large components (>250 lines)\n   - Extract reusable logic to hooks\n\n4. Documentation\n   - Add JSDoc to public APIs\n   - Update architecture diagrams\n\n5. Performance\n   - Consider code splitting for framer-motion\n   - Lazy load heavy components\n\n====================\nSUMMARY\n====================\n\nCodebase Health: ðŸŸ¢ Healthy\n\nThe codebase is well-structured with modern patterns.\nMinor technical debt is manageable. Ready for feature\ndevelopment with recommended refactorings noted above.\n\nKey Findings:\n- Strong TypeScript foundation\n- Consistent React 19 patterns\n- Good test coverage (close to target)\n- Manageable technical debt\n- Clear architecture\n\nRecommended Next Steps:\n1. Address auth.service.ts coupling\n2. Reach 80% test coverage\n3. Proceed with feature development\n```\n\n### Module-Specific Analysis\n\n**Command:**\n```bash\n/context-analyzer --module=authentication --detailed\n```\n\n**Report:**\n```\n[Authentication Module Analysis]\n\n====================\nMODULE OVERVIEW\n====================\n\nLocation: lib/auth/\nFiles: 8 files\nLines: 1,250 LOC\nTests: 12 test files (85% coverage)\n\n====================\nFILE STRUCTURE\n====================\n\nlib/auth/\n  â”œâ”€â”€ index.ts              (Exports)\n  â”œâ”€â”€ auth.service.ts       (Core logic)\n  â”œâ”€â”€ jwt.util.ts          (Token handling)\n  â”œâ”€â”€ password.util.ts     (Hashing)\n  â”œâ”€â”€ session.manager.ts   (Session mgmt)\n  â”œâ”€â”€ oauth.provider.ts    (OAuth flow)\n  â”œâ”€â”€ middleware.ts        (Auth middleware)\n  â””â”€â”€ types.ts            (TypeScript types)\n\n====================\nDEPENDENCIES\n====================\n\nExternal:\n  - bcrypt: Password hashing\n  - jsonwebtoken: JWT creation/verification\n  - better-auth: Core auth library\n\nInternal:\n  â†’ db/client.ts (Database access)\n  â†’ lib/email/service.ts (Verification emails)\n  â†’ lib/config/env.ts (Environment vars)\n\nDependent Modules:\n  â† app/api/auth/* (23 files)\n  â† middleware.ts (Route protection)\n  â† app/(dashboard)/* (18 files)\n\n====================\nKEY PATTERNS\n====================\n\n1. JWT Strategy:\n   - Access token: 15 min expiry\n   - Refresh token: 7 days expiry\n   - Stored in HTTP-only cookies\n\n2. Password Security:\n   - bcrypt with cost factor 12\n   - Password validation: min 8 chars, complexity rules\n\n3. OAuth Flow:\n   - Supported: Google, GitHub\n   - PKCE flow for security\n   - State parameter for CSRF protection\n\n4. Session Management:\n   - Server-side session validation\n   - Automatic refresh on activity\n   - Logout clears all tokens\n\n====================\nSECURITY ANALYSIS\n====================\n\nâœ“ Strengths:\n  - HTTP-only secure cookies\n  - CSRF protection\n  - Rate limiting on auth endpoints\n  - Password complexity requirements\n  - JWT expiration enforced\n\nâš ï¸  Recommendations:\n  - Add 2FA support\n  - Implement session device tracking\n  - Add anomaly detection\n\n====================\nTESTING\n====================\n\nCoverage: 85%\n\nTest Types:\n  - Unit: auth.service.test.ts (42 tests)\n  - Integration: api/auth.test.ts (18 tests)\n  - E2E: auth-flow.spec.ts (8 tests)\n\nGaps:\n  - OAuth error handling (not tested)\n  - Token refresh edge cases (partial)\n\n====================\nREFACTORING NEEDS\n====================\n\nPriority: Medium\n\nRecommendations:\n1. Split auth.service.ts (currently 350 lines)\n   - Extract JWT logic â†’ jwt.service.ts\n   - Extract OAuth â†’ oauth.service.ts\n\n2. Reduce coupling (23 dependencies)\n   - Use dependency injection\n   - Create interfaces for external services\n\n3. Add JSDoc documentation\n   - Document public API methods\n   - Add usage examples\n\nEstimated Effort: 2-3 days\n```\n\n### Before Refactoring Analysis\n\n**Command:**\n```bash\n/context-analyzer --directory=src/components/dashboard --architecture\n```\n\n**Use Case: Planning Refactor**\n```\n[Pre-Refactoring Analysis]\n\nGoal: Refactor dashboard components\n\nCurrent State:\n  Files: 25 components\n  LOC: 3,450 lines\n  Complexity: High (avg 6.8)\n  Dependencies: 45 internal imports\n\nArchitecture Issues:\n  1. Prop drilling (5 levels deep)\n  2. State duplication (3 components)\n  3. Large components (4 files >200 lines)\n  4. Tight coupling (shared state)\n\nRecommended Approach:\n  1. Extract state to Zustand store\n  2. Split large components:\n     - DashboardOverview (280 lines) â†’ 3 components\n     - UserTable (320 lines) â†’ 4 components\n  3. Create composable sub-components\n  4. Use context for shared data\n\nImpact Analysis:\n  - Affected files: 25\n  - Dependent modules: 8\n  - Test files to update: 18\n  - Estimated time: 1 week\n\nReady to proceed? (y/n)\n```\n\n## Use Cases\n\n### 1. Onboarding New Developers\n```bash\n/context-analyzer --full --summary\n\n# New developer gets:\n- Tech stack overview\n- Architecture understanding\n- Code patterns\n- Key files to know\n\nResult: Productive in hours, not days\n```\n\n### 2. Pre-Refactoring Planning\n```bash\n/context-analyzer --module=payments --dependencies\n\n# Before refactoring, understand:\n- What depends on this module\n- Internal coupling\n- Impact of changes\n- Test coverage\n\nResult: Informed refactoring decisions\n```\n\n### 3. Technical Debt Assessment\n```bash\n/context-analyzer --full --quality\n\n# Management gets:\n- Code quality metrics\n- Technical debt level\n- Refactoring priorities\n- Estimated effort\n\nResult: Data-driven planning\n```\n\n### 4. Architecture Documentation\n```bash\n/context-analyzer --architecture --save-to=ARCHITECTURE.md\n\n# Auto-generate:\n- Architecture diagrams\n- Module relationships\n- Data flow\n- Deployment structure\n\nResult: Up-to-date documentation\n```\n\n## Best Practices\n\n1. **Run Before Major Changes**\n   - Understand current state\n   - Identify affected areas\n   - Plan migration path\n\n2. **Regular Health Checks**\n   - Monthly quality analysis\n   - Track metrics over time\n   - Identify degradation early\n\n3. **Onboarding Tool**\n   - Run for new team members\n   - Generate onboarding docs\n   - Update as project evolves\n\n4. **Save Reports**\n   - Version control analysis\n   - Track improvements\n   - Share with team\n\n## Integration with Other Commands\n\n### Context Analysis â†’ Plan Mode\n```bash\n/context-analyzer --module=authentication --dependencies\n# Understand current architecture\n\n/plan-mode \"Refactor authentication module\" --think-harder\n# Create detailed refactoring plan\n```\n\n### Context Analysis â†’ TDD\n```bash\n/context-analyzer --file=payment.service.ts --quality\n# Identify untested code paths\n\n/tdd-workflow \"Add tests for payment edge cases\" --unit\n# Implement missing tests\n```\n\n### Context Analysis â†’ Subagents\n```bash\n/context-analyzer --full --quality\n# Identify refactoring needs\n\n/subagent-create --refactoring-specialist --code-reviewer\n# Deploy specialists for refactoring\n```",
  "configuration": {
    "temperature": 0.2,
    "maxTokens": 8000,
    "systemPrompt": "You are a codebase analysis expert specializing in architecture understanding, pattern detection, and dependency analysis using agentic search for deep project comprehension"
  },
  "githubUrl": "https://github.com/anthropics/claude-code",
  "documentationUrl": "https://docs.claude.com/en/docs/claude-code/analysis",
  "discoveryMetadata": {
    "researchDate": "2025-10-25",
    "trendingSources": [
      {
        "source": "feature_description",
        "evidence": "Claude Code's agentic search capability scans and interprets entire codebase to understand architecture, enabling context-aware development from initial understanding",
        "url": "https://claude.com/product/claude-code",
        "relevanceScore": "high"
      },
      {
        "source": "best_practices",
        "evidence": "Anthropic best practices emphasize understanding full codebase context before major refactors or feature implementations using agentic search",
        "url": "https://www.anthropic.com/engineering/claude-code-best-practices",
        "relevanceScore": "high"
      },
      {
        "source": "community_usage",
        "evidence": "Developer blogs show context analysis as prerequisite for informed decisions, preventing breaking changes and understanding impact",
        "url": "https://www.builder.io/blog/claude-code",
        "relevanceScore": "medium"
      }
    ],
    "keywordResearch": {
      "primaryKeywords": [
        "codebase analysis",
        "context analysis",
        "agentic search",
        "architecture understanding",
        "code intelligence"
      ],
      "searchVolume": "medium",
      "competitionLevel": "medium"
    },
    "gapAnalysis": {
      "existingContent": [],
      "identifiedGap": "No existing command for comprehensive codebase analysis despite agentic search being core capability. Developers need to understand architecture before refactors but no unified command provides: tech stack discovery, dependency analysis, pattern detection, quality metrics. Best practices recommend context-first approach but no tool delivers this systematically.",
      "priority": "medium"
    },
    "approvalRationale": "Agentic search is THE differentiator for Claude Code - ability to understand entire codebase. Anthropic best practices emphasize context before changes, yet NO command delivers systematic analysis. This fills gap: architecture mapping, dependency analysis, quality metrics before refactors. Medium search volume, medium competition, and proven need for architectural understanding make this valuable for complex codebases."
  },
  "troubleshooting": [
    {
      "issue": "Analysis takes very long time for large codebases, seems stuck",
      "solution": "Use scoped analysis instead of --full: analyze specific directories or modules. Add --summary for faster overview. Exclude node_modules and generated files. For codebases >100K LOC, analyze incrementally by directory."
    },
    {
      "issue": "Analysis report shows 'unknown' for tech stack or architecture",
      "solution": "Ensure package.json and tsconfig.json present for detection. Add CLAUDE.md with explicit tech stack info. Use --detailed flag for deeper analysis. Check agentic search has read permissions to all project files."
    },
    {
      "issue": "Dependency analysis shows circular dependencies that don't exist",
      "solution": "False positives can occur with type-only imports. Verify with: npx madge --circular src/. Run analysis on specific module: --module=auth to isolate. Check if analysis confused import types vs runtime dependencies."
    },
    {
      "issue": "Code quality metrics significantly differ from external tools like SonarQube",
      "solution": "Context analyzer uses heuristics, not static analysis. Use --quality with external tools for validation. Metrics are approximate - use for trends, not absolutes. Different tools use different complexity algorithms."
    },
    {
      "issue": "Analysis report doesn't include recently added files or changes",
      "solution": "Context analyzer scans at analysis time. Ensure files saved before running. Git commit recent changes - improves detection. Restart Claude Code if file watcher not detecting new files. Use --force-refresh to clear cache."
    }
  ],
  "source": "community",
  "slug": "context-analyzer",
  "seoTitle": "Context Analyzer for Claude Code"
}
