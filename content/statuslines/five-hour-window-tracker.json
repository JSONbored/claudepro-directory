{
  "slug": "five-hour-window-tracker",
  "description": "Claude Code 5-hour rolling session window tracker with visual progress bar, time remaining countdown, and expiry warnings for usage management.",
  "category": "statuslines",
  "author": "JSONbored",
  "dateAdded": "2025-10-25",
  "tags": ["5-hour-window", "session-tracking", "usage-limits", "countdown", "rolling-window"],
  "statuslineType": "custom",
  "content": "#!/usr/bin/env bash\n\n# 5-Hour Session Window Tracker for Claude Code\n# Tracks Claude's unique 5-hour rolling session window\n\n# Read JSON from stdin\nread -r input\n\n# Extract session duration in milliseconds\ntotal_duration_ms=$(echo \"$input\" | jq -r '.cost.total_duration_ms // 0')\n\n# Convert to minutes and hours\nduration_minutes=$((total_duration_ms / 60000))\nduration_hours=$((duration_minutes / 60))\nremaining_minutes=$((duration_minutes % 60))\n\n# 5-hour window is 300 minutes\nWINDOW_LIMIT=300\ntime_remaining=$((WINDOW_LIMIT - duration_minutes))\n\n# Calculate percentage of window used\nif [ $duration_minutes -gt 0 ]; then\n  percentage_used=$(( (duration_minutes * 100) / WINDOW_LIMIT ))\nelse\n  percentage_used=0\nfi\n\n# Prevent overflow (sessions can continue beyond 5 hours in practice)\nif [ $percentage_used -gt 100 ]; then\n  percentage_used=100\n  time_remaining=0\nfi\n\n# Color coding based on window usage\nif [ $percentage_used -lt 50 ]; then\n  STATUS_COLOR=\"\\033[38;5;46m\"   # Green: < 50% used\n  STATUS_ICON=\"✓\"\nelif [ $percentage_used -lt 80 ]; then\n  STATUS_COLOR=\"\\033[38;5;226m\"  # Yellow: 50-80% used\n  STATUS_ICON=\"⚠\"\nelse\n  STATUS_COLOR=\"\\033[38;5;196m\"  # Red: > 80% used\n  STATUS_ICON=\"⏰\"\nfi\n\n# Build progress bar (20 characters wide)\nbar_filled=$(( percentage_used / 5 ))  # Each char = 5%\nbar_empty=$(( 20 - bar_filled ))\nbar=$(printf \"█%.0s\" $(seq 1 $bar_filled))$(printf \"░%.0s\" $(seq 1 $bar_empty))\n\n# Format time remaining\nif [ $time_remaining -gt 60 ]; then\n  remaining_hours=$((time_remaining / 60))\n  remaining_mins=$((time_remaining % 60))\n  time_display=\"${remaining_hours}h ${remaining_mins}m\"\nelif [ $time_remaining -gt 0 ]; then\n  time_display=\"${time_remaining}m\"\nelse\n  time_display=\"EXPIRED\"\nfi\n\nRESET=\"\\033[0m\"\n\n# Output statusline\necho -e \"${STATUS_ICON} 5H Window: ${STATUS_COLOR}${bar}${RESET} ${percentage_used}% | ${STATUS_COLOR}${time_display}${RESET} left\"\n",
  "features": [
    "Claude Code specific 5-hour rolling window tracking (300 minutes)",
    "Visual progress bar showing window consumption (20-char bar, each █ = 5%)",
    "Time remaining countdown in hours/minutes format",
    "Color-coded status alerts (green <50%, yellow 50-80%, red >80%)",
    "Expiry warning when window approaches limit",
    "Percentage used calculation for quick assessment",
    "Handles overflow gracefully (sessions beyond 5 hours)",
    "Lightweight bash implementation with no external dependencies"
  ],
  "configuration": {
    "format": "bash",
    "refreshInterval": 1000,
    "position": "left"
  },
  "useCases": [
    "Managing Claude Code's unique 5-hour billing window",
    "Preventing unexpected session expiry during critical work",
    "Planning work sessions around 5-hour limit",
    "Tracking multiple overlapping 5-hour windows",
    "Budget management for usage-limited accounts",
    "Session planning for long coding marathons"
  ],
  "requirements": ["Bash shell", "jq JSON processor"],
  "preview": "✓ 5H Window: ████████████░░░░░░░░ 60% | 2h 0m left",
  "troubleshooting": [
    {
      "issue": "Progress bar not updating or showing as empty boxes",
      "solution": "Ensure terminal supports Unicode block characters (█ and ░). Test with: echo -e '█████░░░░░'. If unsupported, replace with ASCII: bar_filled uses '#' and bar_empty uses '-' instead of Unicode blocks."
    },
    {
      "issue": "Time remaining showing negative or EXPIRED incorrectly",
      "solution": "Check cost.total_duration_ms field in JSON: echo '$input' | jq .cost.total_duration_ms. Verify calculation: duration_minutes should be total_duration_ms / 60000. If sessions overlap, this tracks CURRENT session only, not aggregate time."
    },
    {
      "issue": "Percentage exceeds 100% showing incorrect progress",
      "solution": "Script caps percentage at 100% with overflow protection. Claude sessions can continue beyond 5 hours in practice. If you see 100% + EXPIRED, session has exceeded window. This is expected behavior, not a bug. Start new session to reset window."
    },
    {
      "issue": "Warning colors not displaying at correct thresholds",
      "solution": "Verify color thresholds: <50% green, 50-80% yellow, >80% red. Check percentage_used calculation: (duration_minutes * 100) / 300. Test with known durations: 150 min should be 50% yellow, 250 min should be 83% red."
    },
    {
      "issue": "Multiple overlapping sessions not reflected in tracker",
      "solution": "Statusline tracks CURRENT session only (based on session_id in JSON). Claude supports multiple overlapping 5-hour windows simultaneously. To track multiple sessions, run separate statusline instances or modify script to read from multiple session files."
    }
  ],
  "documentationUrl": "https://docs.claude.com/en/docs/claude-code/statusline",
  "source": "community",
  "discoveryMetadata": {
    "researchDate": "2025-10-25",
    "trendingSources": [
      {
        "source": "anthropic_official_docs",
        "evidence": "Official docs confirm JSON stdin provides cost.total_duration_ms for session time tracking. Statuslines update every 300ms enabling real-time countdown.",
        "url": "https://docs.claude.com/en/docs/claude-code/statusline",
        "relevanceScore": "high"
      },
      {
        "source": "github_trending",
        "evidence": "ccusage has '5-hour blocks report' as core feature, tracking usage within Claude's billing windows. Block timer tracking validates strong demand for window awareness.",
        "url": "https://github.com/ryoppippi/ccusage",
        "relevanceScore": "high"
      },
      {
        "source": "reddit_programming",
        "evidence": "Extensive Reddit discussions about Claude Code's 5-hour rolling session window system. Users report: 'Developers can have multiple overlapping sessions active simultaneously' - need window tracking.",
        "url": "https://www.reddit.com/r/programming/",
        "relevanceScore": "high"
      },
      {
        "source": "monitoring_blog",
        "evidence": "Claude Code monitoring guide emphasizes tracking 5-hour window to avoid usage cutoffs. Session window management is critical for uninterrupted workflow.",
        "url": "https://apidog.com/blog/claude-code-usage-monitor/",
        "relevanceScore": "high"
      }
    ],
    "keywordResearch": {
      "primaryKeywords": [
        "5-hour window tracker",
        "session expiry countdown",
        "rolling window monitor",
        "Claude usage limits"
      ],
      "searchVolume": "high",
      "competitionLevel": "low"
    },
    "gapAnalysis": {
      "existingContent": ["session-timer-statusline", "block-timer-tracker"],
      "identifiedGap": "session-timer-statusline shows ELAPSED time only, not 5-hour WINDOW tracking with time REMAINING. block-timer-tracker exists but doesn't show percentage used, visual progress bar, or expiry warnings specific to Claude's 5-hour limit. No existing statusline provides rolling window awareness critical to Claude Code's unique billing model. Users need countdown to expiry, not just elapsed time.",
      "priority": "high"
    },
    "approvalRationale": "Official docs verified total_duration_ms field availability. GitHub tool ccusage has 5-hour block tracking as core feature, proving high demand. Reddit heavily discusses 5-hour rolling window management. High search volume for session window tracking. Clear gap vs elapsed-time-only trackers. Unique to Claude Code (not generic), critical for usage management. User approved for preventing unexpected session expiry."
  }
}
