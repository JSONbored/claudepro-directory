# Supabase Edge Functions Configuration
# This file persists JWT verification settings across redeployments

# =============================================================================
# Unified Webhook Architecture (Database-First)
# =============================================================================
# All webhooks flow through a unified architecture:
#
# INBOUND WEBHOOKS (External → Us):
#   1. External service (Resend/Vercel) → webhook-router edge function
#   2. webhook-router verifies signature (HMAC SHA-256/SHA-1)
#   3. webhook-router inserts to webhook_events table (direction='inbound')
#   4. PostgreSQL trigger routes to appropriate handler based on source enum
#   5. Business logic edge functions process the event
#
# OUTBOUND WEBHOOKS (Us → External):
#   1. Database trigger or edge function calls sendDiscordWebhook() utility
#   2. Utility logs to webhook_events table (direction='outbound')
#   3. Utility sends to Discord with exponential backoff retry
#   4. Success/failure logged back to webhook_events
#
# BENEFITS:
#   - Single source of truth for ALL webhook activity (webhook_events table)
#   - Centralized signature verification (webhook-router)
#   - Shared utilities (Discord webhooks, CORS, validation, response patterns)
#   - Complete audit trail (both directions tracked)
#   - 217 LOC reduction (-12%) with 548 lines of duplicated code eliminated
#
# =============================================================================

# =============================================================================
# Public API Functions - No JWT Verification
# =============================================================================

[functions.llms-txt]
verify_jwt = false  # Public API serving LLMs.txt documentation

[functions.sitemap]
verify_jwt = false  # Public sitemap.xml endpoint

[functions.content-paginated]
verify_jwt = false  # Public content listing with optional auth

[functions.status]
verify_jwt = false  # Public health check endpoint

[functions.feeds]
verify_jwt = false  # Public RSS/Atom feed endpoints (changelog + all content categories)

[functions.json-api]
verify_jwt = false  # Public JSON API endpoint with JSON-LD structured data

[functions.markdown-export]
verify_jwt = false  # Public markdown export endpoint for all categories

[functions.seo-api]
verify_jwt = false  # Public SEO endpoint: metadata + pre-generated schemas (24hr cache)

[functions.readme-generator]
verify_jwt = false  # Public on-demand README generator (database-first, 15ms RPC)

[functions.trending]
verify_jwt = false  # Public trending data with CDN caching (24hr s-maxage)

# =============================================================================
# Webhook Functions - No JWT Verification (Use Signature Verification)
# =============================================================================

[functions.webhook-router]
verify_jwt = false  # Unified webhook router with HMAC SHA-1/SHA-256/Svix verification (replaces resend-webhook)

[functions.email-handler]
verify_jwt = false  # Uses Svix signature verification for auth hooks

[functions.discord-error-relay]
verify_jwt = false  # Database-triggered webhook (internal)

[functions.discord-content-announcement]
verify_jwt = false  # Database-triggered webhook (internal)

[functions.discord-submission-notification]
verify_jwt = false  # Database-triggered webhook (internal)

[functions.changelog-auto-sync]
verify_jwt = false  # Vercel webhook with signature verification

# =============================================================================
# Authenticated Functions - Manual JWT Verification in Code
# =============================================================================

[functions.jobs-handler]
verify_jwt = false  # Manual JWT verification via supabaseServiceRole.auth.getUser()

[functions.analytics]
verify_jwt = true  # Requires authenticated user for analytics tracking
