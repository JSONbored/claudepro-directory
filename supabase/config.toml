# Supabase Edge Functions Configuration
# This file persists JWT verification settings across redeployments

# =============================================================================
# Unified Notification + Webhook Architecture (Database-First)
# =============================================================================
# All inbound/outbound notifications now flow through `notification-router`:
#
# INBOUND (external → us):
#   1. Service (Resend, Vercel, Polar, etc.) → `/functions/v1/notification-router`
#   2. Router verifies signatures via `_shared/utils/webhook/registry.ts`
#   3. Events are persisted to `webhook_events` with idempotency + auditing
#   4. Shared handlers (Discord notifications, changelog sync, ingest) execute business logic
#
# OUTBOUND (us → external):
#   1. Database trigger or edge handler calls `sendDiscordWebhook()` / `createDiscordMessageWithLogging()`
#   2. Helper logs outbound payloads to `webhook_events`
#   3. Discord call executes with retry + status updates
#
# BENEFITS:
#   - Single edge entrypoint (`notification-router`) for Discord, changelog, inbound webhooks, and active-notification fetches
#   - Shared utilities live under `_shared/*`, reducing duplication
#   - Complete audit trail (both directions) via `webhook_events`
#   - Easier deploys (one function) and consistent CORS/signature policy
#
# =============================================================================

# =============================================================================
# Public API Functions - No JWT Verification
# =============================================================================

[functions.data-api]
verify_jwt = false  # Consolidated read-only data access layer (content exports, SEO, feeds, sitemap, status, company, trending)

[functions.unified-search]
verify_jwt = false  # Public search API with optional auth for analytics tracking (5min edge cache)

# =============================================================================
# Webhook/Notification Functions - No JWT Verification (Use Signature Verification)
# =============================================================================

[functions.notification-router]
verify_jwt = false  # Consolidated Discord + external webhook ingest + changelog sync + active notification fetches

[functions.email-handler]
verify_jwt = false  # Uses Svix signature verification for auth hooks

# =============================================================================
# Authenticated Functions - Manual JWT Verification in Code
# =============================================================================

[functions.analytics]
verify_jwt = true  # Requires authenticated user for analytics tracking
