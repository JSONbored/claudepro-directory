name: Changes Filter (Reusable)

on:
  workflow_call:
    outputs:
      code:
        description: 'Code changes present'
        value: ${{ jobs.filter.outputs.code }}
      deps:
        description: 'Dependency changes present'
        value: ${{ jobs.filter.outputs.deps }}
      tests:
        description: 'Test changes present'
        value: ${{ jobs.filter.outputs.tests }}
      content:
        description: 'Content changes present'
        value: ${{ jobs.filter.outputs.content }}
      seo:
        description: 'SEO-affecting changes present'
        value: ${{ jobs.filter.outputs.seo }}
      public:
        description: 'Public assets changed'
        value: ${{ jobs.filter.outputs.public }}

jobs:
  filter:
    name: Detect Changes
    runs-on: ubuntu-latest
    timeout-minutes: 5
    outputs:
      code: ${{ steps.filter.outputs.code }}
      deps: ${{ steps.filter.outputs.deps }}
      tests: ${{ steps.filter.outputs.tests }}
      content: ${{ steps.filter.outputs.content }}
      seo: ${{ steps.filter.outputs.seo }}
      public: ${{ steps.filter.outputs.public }}

    steps:
      - uses: actions/checkout@v5

      - name: Check changed files
        id: filter
        uses: dorny/paths-filter@v3
        with:
          filters: |
            code:
              - 'src/**/*.{ts,tsx,js,jsx}'
              - 'scripts/**'
              - 'config/**'
              - 'next.config.mjs'
              - 'tailwind.config.ts'
            deps:
              - 'package.json'
              - 'package-lock.json'
            tests:
              - 'tests/**'
              - 'src/**/*.test.{ts,tsx,js,jsx}'
              - 'jest.config.*'
              - 'config/tools/playwright.config.ts'
            content:
              - 'content/**/*.json'
              - 'content/**/*.mdx'
              - 'templates/**'
            seo:
              - 'content/**/*.mdx'
              - 'content/**/*.json'
              - 'src/app/**/page.tsx'
              - 'src/lib/seo/**'
            public:
              - 'public/**'
