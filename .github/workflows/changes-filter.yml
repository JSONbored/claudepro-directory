name: Changes Filter (Reusable)

on:
  workflow_call:
    outputs:
      code:
        description: 'Code changes present'
        value: ${{ jobs.filter.outputs.code }}
      deps:
        description: 'Dependency changes present'
        value: ${{ jobs.filter.outputs.deps }}
      tests:
        description: 'Test changes present'
        value: ${{ jobs.filter.outputs.tests }}
      database:
        description: 'Database schema changes present'
        value: ${{ jobs.filter.outputs.database }}
      public:
        description: 'Public assets changed'
        value: ${{ jobs.filter.outputs.public }}
      generated:
        description: 'Auto-generated files changed'
        value: ${{ jobs.filter.outputs.generated }}

jobs:
  filter:
    name: Detect Changes
    runs-on: ubuntu-latest
    timeout-minutes: 5
    outputs:
      code: ${{ steps.filter.outputs.code }}
      deps: ${{ steps.filter.outputs.deps }}
      tests: ${{ steps.filter.outputs.tests }}
      database: ${{ steps.filter.outputs.database }}
      public: ${{ steps.filter.outputs.public }}
      generated: ${{ steps.filter.outputs.generated }}

    steps:
      - uses: actions/checkout@v5

      - name: Check changed files
        id: filter
        uses: dorny/paths-filter@v3
        with:
          filters: |
            code:
              - 'src/**/*.{ts,tsx,js,jsx}'
              - 'scripts/**'
              - 'config/**'
              - 'supabase/functions/**'
              - 'next.config.mjs'
              - 'tailwind.config.ts'
            deps:
              - 'package.json'
              - 'pnpm-lock.yaml'
            tests:
              - 'tests/**'
              - 'src/**/*.test.{ts,tsx,js,jsx}'
              - 'jest.config.*'
              - 'config/tools/playwright.config.ts'
            database:
              - 'supabase/schema.sql'
              - 'supabase/migrations/**'
              - 'src/types/database.types.ts'
              - 'generated/db-schemas.ts'
            public:
              - 'public/**'
            generated:
              - 'generated/**'
              - 'src/types/database.types.ts'
              - 'public/service-worker.js'
