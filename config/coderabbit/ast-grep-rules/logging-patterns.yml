# Logging Pattern Rules
# Enforces logging standards from .cursor/rules/logging-instrumentation.mdc
# Updated to match current logging architecture: packages/shared-runtime/src/logger/index.ts
# Matches: config/tools/eslint-plugin-architectural-rules.js -> require-logging-context

---
# Rule: Detect console.* usage (should use logger instead)
id: no-console-usage
language: TypeScript
rule:
  pattern: console.$METHOD($$$)
  kind: call_expression
  has:
    kind: member_expression
    pattern: console.$METHOD
message: "Use structured logging (logger.*) instead of console.*. Import logger from @heyclaude/shared-runtime/logger (server) or @heyclaude/web-runtime/logging/client (client)"
severity: error
fix: |
  // Replace console.$METHOD with appropriate logger method
  // Server: logger.info/warn/error from @heyclaude/shared-runtime/logger
  // Client: logClientInfo/logClientWarn/logClientError from @heyclaude/web-runtime/logging/client

---
# Rule: Detect missing normalizeError in catch blocks
id: missing-normalize-error
language: TypeScript
rule:
  all:
    - pattern: catch ($ERROR) { $$$ }
      kind: catch_clause
    - not:
        has:
          pattern: normalizeError($$$)
message: "Catch blocks must use normalizeError() before logging or throwing. Import normalizeError from @heyclaude/shared-runtime/logger"
severity: error

---
# Rule: Detect missing logger.child() for request-scoped context in server components
id: missing-logger-child-context
language: TypeScript
rule:
  all:
    - pattern: export default async function $NAME($$$) { $$$ }
      kind: function_declaration
    - inside:
        pattern: app/**/*.tsx
    - has:
        pattern: logger.$METHOD($$$)
    - not:
        has:
          pattern: const $LOGGER = logger.child({ operation: $OP, route: $ROUTE })
message: "Server components/pages must use logger.child({ operation, route }) for request-scoped context. Create: const reqLogger = logger.child({ operation: 'PageName', route: '/path' }) and use reqLogger for all logs"
severity: error

---
# Rule: Detect missing operation/route in logger.child() calls
id: missing-operation-route-in-child
language: TypeScript
rule:
  all:
    - pattern: logger.child({ $$$ })
      kind: call_expression
    - not:
        has:
          pattern: operation: $OP
    - not:
        has:
          pattern: route: $ROUTE
message: "logger.child() must include operation and route fields. Use: logger.child({ operation: 'PageName', route: '/path' })"
severity: error

---
# Rule: Detect missing useLoggedAsync in client async operations
id: missing-use-logged-async
language: TypeScript
rule:
  all:
    - pattern: const $HANDLER = async () => { $$$ }
      kind: variable_declarator
    - inside:
        pattern: 'use client'
    - not:
        has:
          pattern: useLoggedAsync($$$)
message: "Client components with async operations must use useLoggedAsync hook. Import useLoggedAsync from @heyclaude/web-runtime/hooks"
severity: warning
