// -----------------------------------------------------------------------------
// ðŸ”’ AUTO-GENERATED - DO NOT EDIT
// Generated by packages/generators/src/commands/generate-server-actions.ts
// -----------------------------------------------------------------------------

import { z } from 'zod';
import { authedAction } from './safe-action';
import { runRpc } from './run-rpc-instance';
import { logActionFailure } from '../errors';
import type { Database } from '@heyclaude/database-types';
import { revalidatePath, revalidateTag } from 'next/cache';
import { nextInvalidateByKeys } from '../cache-tags';
import { getCacheConfigSnapshot } from '../cache-config';

export const updateCompanySchema = z.object({
  id: z.string().uuid().nullable().optional(),
  name: z.string().nullable().optional(),
  slug: z.string().nullable().optional(),
  logo: z.string().nullable().optional(),
  website: z.string().nullable().optional(),
  description: z.string().nullable().optional(),
  size: z.enum(['just_me', '2-10', '11-50', '51-200', '201-500', '500+']).nullable().optional(),
  industry: z.string().nullable().optional(),
  using_cursor_since: z.string().nullable().optional()
});
export type UpdateCompanyInput = z.infer<typeof updateCompanySchema>;

export const updateCompany = authedAction
  .metadata({ actionName: 'updateCompany', category: 'content' })
  .inputSchema(updateCompanySchema)
  .action(async ({ parsedInput, ctx }) => {
    try {
      const rawResult = await runRpc<Database['public']['Functions']['manage_company']['Returns']>(
        'manage_company',
        {
          'p_action': 'update',
          'p_user_id': ctx.userId,
          'p_create_data': null,
          'p_update_data': {
            'id': parsedInput.id,
            'name': parsedInput.name,
            'slug': parsedInput.slug,
            'logo': parsedInput.logo,
            'website': parsedInput.website,
            'description': parsedInput.description,
            'size': parsedInput.size,
            'industry': parsedInput.industry,
            'using_cursor_since': parsedInput.using_cursor_since
          }
        },
        {
          action: 'updateCompany.rpc',
          userId: ctx.userId,
        }
      );

      
      const result = rawResult;
      

      // Simple success check?
      // Some RPCs return void, some return { success: boolean }?
      // We assume implicit success if no error thrown by runRpc.
      
      revalidatePath(`/account/companies`);
      revalidatePath(`/companies/${result?.company?.slug}`);
      revalidatePath(`/companies`);
      revalidateTag(`company-${result?.company?.slug}`, 'default');
      revalidateTag(`company-id-${result?.company?.id}`, 'default');
      
      await nextInvalidateByKeys({
        cacheConfigPromise: getCacheConfigSnapshot(),
        invalidateKeys: ['cache.invalidate.company_update']
      });

      

      return result;
    } catch (error) {
      throw logActionFailure('updateCompany', error, {
        userId: ctx.userId,
        input: parsedInput
      });
    }
  });
