'use server';

// -----------------------------------------------------------------------------
// ðŸ”’ AUTO-GENERATED - DO NOT EDIT
// Generated by packages/generators/src/commands/generate-server-actions.ts
// -----------------------------------------------------------------------------

import { z } from 'zod';
import { authedAction } from './safe-action';
import { runRpc } from './run-rpc-instance';
import type { Database } from '@heyclaude/database-types';

const submitContentForReviewSchema = z.object({
  submission_type: z.enum(['agents', 'mcp', 'rules', 'commands', 'hooks', 'statuslines', 'skills']),
  name: z.string(),
  description: z.string(),
  category: z.enum(['agents', 'mcp', 'rules', 'commands', 'hooks', 'statuslines', 'skills', 'collections', 'guides', 'jobs', 'changelog']),
  author: z.string(),
  content_data: z.any(),
  author_profile_url: z.string().optional(),
  github_url: z.string().optional(),
  tags: z.array(z.string()).optional()
});
export type SubmitContentForReviewInput = z.infer<typeof submitContentForReviewSchema>;

export const submitContentForReview = authedAction
  .metadata({ actionName: 'submitContentForReview', category: 'content' })
  .inputSchema(submitContentForReviewSchema)
  .action(async ({ parsedInput, ctx }) => {
    try {
      const rawResult = await runRpc<Database['public']['Functions']['submit_content_for_review']['Returns']>(
        'submit_content_for_review',
        {
          'p_submission_type': parsedInput.submission_type,
          'p_name': parsedInput.name,
          'p_description': parsedInput.description,
          'p_category': parsedInput.category,
          'p_author': parsedInput.author,
          'p_content_data': parsedInput.content_data,
          'p_author_profile_url': parsedInput.author_profile_url,
          'p_github_url': parsedInput.github_url,
          'p_tags': parsedInput.tags
        },
        {
          action: 'submitContentForReview.rpc',
          userId: ctx.userId,
        }
      );

      
      const result = rawResult;
      
      
      // Lazy import server-only dependencies
      // const { logActionFailure } = await import('../errors');
      const { revalidatePath } = await import('next/cache');
      
      const { nextInvalidateByKeys } = await import('../cache-tags');
      const { getCacheConfigSnapshot } = await import('../cache-config');

      // Simple success check?
      // Some RPCs return void, some return { success: boolean }?
      // We assume implicit success if no error thrown by runRpc.
      
      revalidatePath(`/account/submissions`);
      
      await nextInvalidateByKeys({
        cacheConfigPromise: getCacheConfigSnapshot(),
        invalidateKeys: ['cache.invalidate.submission_create']
      });

      

      return result;
    } catch (error) {
      // Lazy import logActionFailure
      const { logActionFailure } = await import('../errors');
      throw logActionFailure('submitContentForReview', error, {
        userId: ctx.userId,
        input: parsedInput
      });
    }
  });
