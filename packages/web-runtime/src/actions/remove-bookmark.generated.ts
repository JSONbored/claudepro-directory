// -----------------------------------------------------------------------------
// ðŸ”’ AUTO-GENERATED - DO NOT EDIT
// Generated by packages/generators/src/commands/generate-server-actions.ts
// -----------------------------------------------------------------------------

import { z } from 'zod';
import { authedAction } from './safe-action';
import { runRpc } from './run-rpc-instance';
import { logActionFailure } from '../errors';
import type { Database } from '@heyclaude/database-types';
import { revalidatePath, revalidateTag } from 'next/cache';
import { nextInvalidateByKeys } from '../cache-tags';
import { getCacheConfigSnapshot } from '../cache-config';

export const removeBookmarkSchema = z.object({
  content_type: z.enum(['agents', 'mcp', 'rules', 'commands', 'hooks', 'statuslines', 'skills', 'collections', 'guides', 'jobs', 'changelog']),
  content_slug: z.string()
});
export type RemoveBookmarkInput = z.infer<typeof removeBookmarkSchema>;

export const removeBookmark = authedAction
  .metadata({ actionName: 'removeBookmark', category: 'user' })
  .inputSchema(removeBookmarkSchema)
  .action(async ({ parsedInput, ctx }) => {
    try {
      const rawResult = await runRpc<Database['public']['Functions']['remove_bookmark']['Returns']>(
        'remove_bookmark',
        {
          'p_user_id': ctx.userId,
          'p_content_type': parsedInput.content_type,
          'p_content_slug': parsedInput.content_slug
        },
        {
          action: 'removeBookmark.rpc',
          userId: ctx.userId,
        }
      );

      
      const result = rawResult;
      

      // Simple success check?
      // Some RPCs return void, some return { success: boolean }?
      // We assume implicit success if no error thrown by runRpc.
      
      revalidatePath(`/account`);
      revalidatePath(`/account/library`);
      revalidateTag(`user-bookmarks`, 'default');
      revalidateTag(`user-${ctx.userId}`, 'default');
      revalidateTag(`content-${parsedInput.content_slug}`, 'default');
      
      await nextInvalidateByKeys({
        cacheConfigPromise: getCacheConfigSnapshot(),
        invalidateKeys: ['cache.invalidate.bookmark_delete']
      });

      

      return result;
    } catch (error) {
      throw logActionFailure('removeBookmark', error, {
        userId: ctx.userId,
        input: parsedInput
      });
    }
  });
