/**
 * ðŸ”’ AUTO-GENERATED SERVICE - DO NOT EDIT DIRECTLY
 * 
 * This file is generated by the "Hollow Core" architecture generator.
 * To update this service, update the database schema and re-run the generator.
 */

import type { Database } from '@heyclaude/database-types';
import type { SupabaseClient } from '@supabase/supabase-js';

export interface ContentFilterOptions {
  categories?: Database['public']['Enums']['content_category'][] | undefined;
  tags?: string[] | undefined;
  search?: string;
  author?: string;
  orderBy?: 'slug' | 'created_at' | 'updated_at' | 'title';
  orderDirection?: 'asc' | 'desc';
  limit?: number;
  offset?: number;
}

export interface ReviewsFilterOptions {
  contentType: Database['public']['Enums']['content_category'];
  contentSlug: string;
  sortBy?: string;
  limit?: number;
  offset?: number;
  userId?: string;
}

export interface RelatedContentOptions {
  category: Database['public']['Enums']['content_category'];
  slug: string;
  tags?: string[] | undefined;
  limit?: number;
  excludeSlugs?: string[];
}

export interface SimilarContentOptions {
  contentType: Database['public']['Enums']['content_category'];
  contentSlug: string;
  limit?: number;
}

export class ContentService {
  constructor(private supabase: SupabaseClient<Database>) {}

  /**
   * Calls the database RPC: generate_readme_data
   */
  async getSitewideReadme() {
    const { data, error } = await this.supabase.rpc('generate_readme_data');
    if (error) throw error;
    return data as Database['public']['Functions']['generate_readme_data']['Returns'];
  }

  /**
   * Calls the database RPC: generate_sitewide_llms_txt
   */
  async getSitewideLlmsTxt() {
    const { data, error } = await this.supabase.rpc('generate_sitewide_llms_txt');
    if (error) throw error;
    return data as Database['public']['Functions']['generate_sitewide_llms_txt']['Returns'];
  }

  /**
   * Calls the database RPC: generate_changelog_llms_txt
   */
  async getChangelogLlmsTxt() {
    const { data, error } = await this.supabase.rpc('generate_changelog_llms_txt');
    if (error) throw error;
    return data as Database['public']['Functions']['generate_changelog_llms_txt']['Returns'];
  }

  /**
   * Calls the database RPC: generate_category_llms_txt
   */
  async getCategoryLlmsTxt(args: Database['public']['Functions']['generate_category_llms_txt']['Args']) {
    const { data, error } = await this.supabase.rpc('generate_category_llms_txt', args);
    if (error) throw error;
    return data as Database['public']['Functions']['generate_category_llms_txt']['Returns'];
  }

  /**
   * Calls the database RPC: generate_changelog_entry_llms_txt
   */
  async getChangelogEntryLlmsTxt(args: Database['public']['Functions']['generate_changelog_entry_llms_txt']['Args']) {
    const { data, error } = await this.supabase.rpc('generate_changelog_entry_llms_txt', args);
    if (error) throw error;
    return data as Database['public']['Functions']['generate_changelog_entry_llms_txt']['Returns'];
  }

  /**
   * Calls the database RPC: generate_tool_llms_txt
   */
  async getToolLlmsTxt(args: Database['public']['Functions']['generate_tool_llms_txt']['Args']) {
    const { data, error } = await this.supabase.rpc('generate_tool_llms_txt', args);
    if (error) throw error;
    return data as Database['public']['Functions']['generate_tool_llms_txt']['Returns'];
  }

  /**
   * Calls the database RPC: get_category_configs_with_features
   */
  async getCategoryConfigs() {
    const { data, error } = await this.supabase.rpc('get_category_configs_with_features');
    if (error) throw error;
    return data as Database['public']['Functions']['get_category_configs_with_features']['Returns'];
  }

  /**
   * Calls the database RPC: get_api_content_full
   */
  async getApiContentFull(args: Database['public']['Functions']['get_api_content_full']['Args']) {
    const { data, error } = await this.supabase.rpc('get_api_content_full', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_api_content_full']['Returns'];
  }

  /**
   * Calls the database RPC: get_content_detail_complete
   */
  async getContentDetailComplete(args: Database['public']['Functions']['get_content_detail_complete']['Args']) {
    const { data, error } = await this.supabase.rpc('get_content_detail_complete', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_content_detail_complete']['Returns'];
  }

  /**
   * Calls the database RPC: get_enriched_content_list
   */
  async getEnrichedContentList(args: Database['public']['Functions']['get_enriched_content_list']['Args']) {
    const { data, error } = await this.supabase.rpc('get_enriched_content_list', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_enriched_content_list']['Returns'];
  }

  /**
   * Calls the database RPC: get_content_paginated
   */
  async getContentPaginated(args: Database['public']['Functions']['get_content_paginated']['Args']) {
    const { data, error } = await this.supabase.rpc('get_content_paginated', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_content_paginated']['Returns'];
  }

  /**
   * Calls the database RPC: get_homepage_complete
   */
  async getHomepageComplete(args: Database['public']['Functions']['get_homepage_complete']['Args']) {
    const { data, error } = await this.supabase.rpc('get_homepage_complete', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_homepage_complete']['Returns'];
  }

  /**
   * Calls the database RPC: get_reviews_with_stats
   */
  async getReviewsWithStats(args: Database['public']['Functions']['get_reviews_with_stats']['Args']) {
    const { data, error } = await this.supabase.rpc('get_reviews_with_stats', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_reviews_with_stats']['Returns'];
  }

  /**
   * Calls the database RPC: get_related_content
   */
  async getRelatedContent(args: Database['public']['Functions']['get_related_content']['Args']) {
    const { data, error } = await this.supabase.rpc('get_related_content', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_related_content']['Returns'];
  }

  /**
   * Calls the database RPC: get_similar_content
   */
  async getSimilarContent(args: Database['public']['Functions']['get_similar_content']['Args']) {
    const { data, error } = await this.supabase.rpc('get_similar_content', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_similar_content']['Returns'];
  }

  /**
   * Calls the database RPC: get_content_templates
   */
  async getContentTemplates(args: Database['public']['Functions']['get_content_templates']['Args']) {
    const { data, error } = await this.supabase.rpc('get_content_templates', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_content_templates']['Returns'];
  }

  /**
   * Calls the database RPC: get_content_paginated_slim
   */
  async getContentPaginatedSlim(args: Database['public']['Functions']['get_content_paginated_slim']['Args']) {
    const { data, error } = await this.supabase.rpc('get_content_paginated_slim', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_content_paginated_slim']['Returns'];
  }

  /**
   * Calls the database RPC: get_content_detail_core
   */
  async getContentDetailCore(args: Database['public']['Functions']['get_content_detail_core']['Args']) {
    const { data, error } = await this.supabase.rpc('get_content_detail_core', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_content_detail_core']['Returns'];
  }

  /**
   * Calls the database RPC: get_content_analytics
   */
  async getContentAnalytics(args: Database['public']['Functions']['get_content_analytics']['Args']) {
    const { data, error } = await this.supabase.rpc('get_content_analytics', args);
    if (error) throw error;
    return data as Database['public']['Functions']['get_content_analytics']['Returns'];
  }

  /**
   * Calls the database RPC: get_homepage_optimized
   * 
   * CRITICAL: Supabase RPCs returning composite types (RETURNS, not RETURNS SETOF)
   * return the data in a specific format. We need to handle this correctly.
   */
  async getHomepageOptimized(args: Database['public']['Functions']['get_homepage_optimized']['Args']) {
    const { data, error } = await this.supabase.rpc('get_homepage_optimized', args);
    
    if (error) {
      // Log the error for debugging
      console.error('[ContentService.getHomepageOptimized] RPC error:', error);
      throw error;
    }
    
    // DEBUG: Log what we actually received
    console.log('[ContentService.getHomepageOptimized] Raw data from RPC:', {
      dataType: typeof data,
      isNull: data === null,
      isUndefined: data === undefined,
      isArray: Array.isArray(data),
      dataKeys: data && typeof data === 'object' ? Object.keys(data) : 'not-object',
      dataSample: data && typeof data === 'object' ? JSON.stringify(data).substring(0, 200) : String(data),
    });
    
    // Supabase returns composite types as a single object (not array) for RETURNS (not SETOF)
    // But if function returns no rows, data will be null
    if (data === null || data === undefined) {
      console.warn('[ContentService.getHomepageOptimized] Data is null/undefined!');
      return null;
    }
    
    // If data is an array (shouldn't happen for non-SETOF, but be defensive), take first element
    if (Array.isArray(data)) {
      console.warn('[ContentService.getHomepageOptimized] Data is an array (unexpected for non-SETOF), taking first element');
      return (data[0] ?? null) as Database['public']['Functions']['get_homepage_optimized']['Returns'];
    }
    
    // Data should be a single object
    if (typeof data !== 'object') {
      console.error('[ContentService.getHomepageOptimized] Data is not an object:', typeof data, data);
      return null;
    }
    
    return data as Database['public']['Functions']['get_homepage_optimized']['Returns'];
  }
}
